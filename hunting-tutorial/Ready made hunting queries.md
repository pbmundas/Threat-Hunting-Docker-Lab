# 100 Mordor Threat Hunting Queries (KQL) — Fields mapped to your ELK schema

**Fields used:** `@timestamp`, `Hostname`, `NewProcessName`, `ParentProcessName`, `ProcessId`, `CommandLine`, `EventID`, `EventType`, `Message`, `SubjectUserName`, `TargetUserName`, `log.file.path`, `port`, `host.name`, `event.original`, `SourceName`, `SourceModuleName`

> Paste each KQL query into **Kibana Discover** (select appropriate time range). These queries use your field names exactly as provided.

|   # | Hypothesis                                                                                  | KQL Query                                                                                                                                              |                                                    |
| --: | ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------- |
|   1 | PowerShell executed with encoded command — likely malicious.                                | `NewProcessName: "powershell.exe" AND CommandLine:("-EncodedCommand" OR "-enc" OR "IEX" OR "Invoke-Expression")`                                       |                                                    |
|   2 | PowerShell run from Temp folder — possible fileless activity.                               | `NewProcessName: "powershell.exe" AND CommandLine:("C:\\Users\\*\\AppData\\Local\\Temp\\*" OR "C:\\Windows\\Temp\\*") OR log.file.path:("*\\Temp\\*")` |                                                    |
|   3 | WMIC used to create processes remotely — potential lateral movement.                        | `NewProcessName: "wmic.exe" AND CommandLine:("process call create" OR "process call")`                                                                 |                                                    |
|   4 | cmd.exe used with base64 or PowerShell in commandline — suspicious automation.              | `NewProcessName: "cmd.exe" AND CommandLine:("base64" OR "powershell")`                                                                                 |                                                    |
|   5 | mshta executing a remote URL — fileless remote execution.                                   | `NewProcessName: "mshta.exe" AND CommandLine:("http" OR "https")`                                                                                      |                                                    |
|   6 | cscript/wscript running scripts — possible malicious scripts.                               | `NewProcessName:("cscript.exe" OR "wscript.exe") AND CommandLine:(".vbs" OR ".js")`                                                                    |                                                    |
|   7 | Admin tools run from user directories — potential misuse.                                   | `NewProcessName:("taskkill.exe" OR "net.exe" OR "sc.exe") AND CommandLine:("C:\\Users\\*")`                                                            |                                                    |
|   8 | PowerShell downloading files from web — likely staging/C2.                                  | `NewProcessName: "powershell.exe" AND CommandLine:("Invoke-WebRequest" OR "DownloadFile" OR "New-Object System.Net.WebClient")`                        |                                                    |
|   9 | rundll32 launching remote DLLs or URLs — suspicious.                                        | `NewProcessName: "rundll32.exe" AND CommandLine:("http" OR "https" OR ".dll")`                                                                         |                                                    |
|  10 | Executables running from Downloads or Temp folders — suspicious drops.                      | `CommandLine:("C:\\Users\\*\\Downloads\\*" OR "C:\\Users\\*\\AppData\\Local\\Temp\\*") OR log.file.path:("*\\Downloads\\*" OR "*\\Temp\\*")`           |                                                    |
|  11 | New Windows service creation (EventID 7045) — persistence.                                  | `EventID: 7045`                                                                                                                                        |                                                    |
|  12 | Scheduled task created by non-system account (EventID 4698).                                | `EventID: 4698 AND SubjectUserName: NOT ("SYSTEM" OR "Administrator")`                                                                                 |                                                    |
|  13 | Registry Run keys modified (search in Message) — persistence.                               | `Message: ("Run\\" OR "CurrentVersion\\Run" OR "RunOnce")`                                                                                             |                                                    |
|  14 | Files created in Startup folders — persistence artifacts.                                   | `log.file.path:("*\\Start Menu\\Programs\\Startup\\*" OR "*\\Startup\\*")`                                                                             |                                                    |
|  15 | RunOnce entries created — possible single-run persistence.                                  | `Message: ("RunOnce" OR "CurrentVersion\\RunOnce")`                                                                                                    |                                                    |
|  16 | Scheduled tasks executing from Temp — suspicious.                                           | `EventID: 4698 AND CommandLine:("Temp" OR "AppData\\Local\\Temp")`                                                                                     |                                                    |
|  17 | Services installed with binary path in user folders — malicious install.                    | `EventID: 7045 AND Message:("C:\\Users\\" OR "C:\\Temp\\")`                                                                                            |                                                    |
|  18 | WMI event filter/consumer registry modifications — stealth persistence.                     | `Message: ("EventFilter" OR "EventConsumer" OR "FilterToConsumerBinding" OR "WBEM")`                                                                   |                                                    |
|  19 | Scheduled tasks by non-standard users or odd triggers.                                      | `EventID: 4698 AND SubjectUserName: NOT ("SYSTEM" OR "Administrator")`                                                                                 |                                                    |
|  20 | Scripts placed in Startup and executed.                                                     | `log.file.path:("*\\Startup\\*") AND NewProcessName:("powershell.exe" OR "cmd.exe" OR "cscript.exe")`                                                  |                                                    |
|  21 | Mimikatz or credential dumper executed.                                                     | `NewProcessName: "mimikatz.exe" OR CommandLine:("sekurlsa" OR "LogonPasswords" )`                                                                      |                                                    |
|  22 | Process accessing LSASS (process access events in Message).                                 | `EventType: "ProcessAccess" OR Message: ("lsass.exe" AND ("OpenProcess" OR "ReadProcessMemory" OR "QueryInformation"))`                                |                                                    |
|  23 | certutil or rundll32 used to stage payloads (decode/download).                              | `NewProcessName:("certutil.exe" OR "rundll32.exe") AND CommandLine:("-decode" OR "-urlcache" OR "http" OR "https")`                                    |                                                    |
|  24 | PowerShell invoking credential-dumping modules.                                             | `NewProcessName: "powershell.exe" AND CommandLine:("Invoke-Mimikatz" OR "sekurlsa" OR "LogonPasswords")`                                               |                                                    |
|  25 | Attempts to read SAM/SYSTEM hives via file access in Message.                               | `Message: ("\Windows\System32\config\SAM" OR "\Windows\System32\config\SYSTEM") OR log.file.path:("*\\config\\SAM" )`                                  |                                                    |
|  26 | Network connections on unusual ports (non-standard).                                        | `EventType: "Network" AND port: NOT (80 OR 443 OR 53 OR 22 OR 21)`                                                                                     |                                                    |
|  27 | Repeated outbound connections to same external host — beaconing (use Message to find dest). | `EventType: "Network" AND Message: NOT ("10." OR "192.168." OR "172.")`                                                                                |                                                    |
|  28 | PowerShell initiating network connections (process with EventType Network).                 | `NewProcessName: "powershell.exe" AND EventType: "Network"`                                                                                            |                                                    |
|  29 | DNS with random-looking subdomains (search Message).                                        | `EventType: "dns" AND Message: /[a-z0-9]{8,}\./`                                                                                                       |                                                    |
|  30 | Large outbound bytes indicated in Message — possible exfil.                                 | `EventType: "Network" AND Message: /bytes_sent.*[5-9][0-9]{5,}/`                                                                                       |                                                    |
|  31 | PsExec usage for remote execution.                                                          | `NewProcessName: "psexec.exe" OR CommandLine: "\\\\*"`                                                                                                 |                                                    |
|  32 | RDP logons (EventID 4624 with LogonType 10) from external hosts (Message contains source).  | `EventID: 4624 AND Message: ("LogonType: 10") AND Message: NOT ("10." OR "192.168.")`                                                                  |                                                    |
|  33 | PowerShell/WinRM remote execution to other hosts.                                           | `NewProcessName:("winrm.exe" OR "wmic.exe" OR "powershell.exe") AND CommandLine:("-ComputerName" OR "-Hostname" )`                                     |                                                    |
|  34 | SMB connections to many hosts — lateral scan (Message contains dest).                       | `EventType: "Network" AND Message: (" dest_port: 445" OR "SMB")`                                                                                       |                                                    |
|  35 | One account logging onto many hosts (possible credential reuse).                            | `EventID: 4624 AND SubjectUserName: *                                                                                                                  | stats count() by SubjectUserName`                  |
|  36 | Service created by non-admin user (user in SubjectUserName).                                | `EventID: 7045 AND SubjectUserName: NOT ("SYSTEM" OR "Administrator")`                                                                                 |                                                    |
|  37 | Scheduled task invoking PowerShell from Temp.                                               | `EventID: 4698 AND CommandLine:("powershell.exe" AND "Temp")`                                                                                          |                                                    |
|  38 | Creation of archives in Temp or Downloads (staging).                                        | `Message: (".zip" OR ".rar" OR ".7z") AND log.file.path:("*\\Temp\\*" OR "*\\Downloads\\*")`                                                           |                                                    |
|  39 | Scheduled tasks with suspicious names or outside Microsoft paths.                           | `EventID: 4698 AND Message: NOT ("\\Microsoft\\") AND Message: ("Updater" OR "svchost")`                                                               |                                                    |
|  40 | Service image path modified to non-System32 path.                                           | `EventID: 7045 AND Message: NOT ("C:\\Windows\\System32\\")`                                                                                           |                                                    |
|  41 | certutil used to download or decode files.                                                  | `NewProcessName: "certutil.exe" AND CommandLine:("-urlcache" OR "-decode" OR "http" )`                                                                 |                                                    |
|  42 | bitsadmin used for HTTP/S downloads.                                                        | `NewProcessName: "bitsadmin.exe" AND CommandLine:("http" OR "https")`                                                                                  |                                                    |
|  43 | mshta executing remote scripts (fileless).                                                  | `NewProcessName: "mshta.exe" AND CommandLine:("http" OR "https")`                                                                                      |                                                    |
|  44 | regsvr32 invoking script components/sct files.                                              | `NewProcessName: "regsvr32.exe" AND CommandLine:(".sct" OR ".dll")`                                                                                    |                                                    |
|  45 | rundll32 loading DLLs from non-System32 paths.                                              | `NewProcessName: "rundll32.exe" AND log.file.path: NOT ("C:\\Windows\\System32\\*")`                                                                   |                                                    |
|  46 | WMI subscription creation — search Message for filters/consumers.                           | `Message: ("EventFilter" OR "EventConsumer" OR "FilterToConsumerBinding" )`                                                                            |                                                    |
|  47 | Commands to stop or delete security services/tools.                                         | `CommandLine: ("sc stop" OR "sc delete" OR "taskkill /f /im")`                                                                                         |                                                    |
|  48 | PowerShell scripts located in AppData/Temp.                                                 | `NewProcessName: "powershell.exe" AND CommandLine:("AppData\\Roaming" OR "AppData\\Local\\Temp")`                                                      |                                                    |
|  49 | Encoded or obfuscated commands in any process CommandLine.                                  | `CommandLine: ("-enc" OR "-EncodedCommand" OR "IEX" )`                                                                                                 |                                                    |
|  50 | Trusted utilities invoked with URL or encoded arguments.                                    | `NewProcessName:("regsvr32.exe" OR "rundll32.exe" OR "mshta.exe" OR "certutil.exe") AND CommandLine:("http" OR "-EncodedCommand" )`                    |                                                    |
|  51 | ProcessAccess to LSASS in Message — token theft.                                            | `Message: ("lsass.exe" AND ("ReadProcessMemory" OR "OpenProcess"))`                                                                                    |                                                    |
|  52 | rundll32 loading temporary DLLs indicating droppers.                                        | `NewProcessName: "rundll32.exe" AND CommandLine:("Temp" OR "AppData")`                                                                                 |                                                    |
|  53 | PowerShell starting hidden processes (Start-Process -WindowStyle Hidden).                   | `NewProcessName: "powershell.exe" AND CommandLine: ("Start-Process" AND "Hidden")`                                                                     |                                                    |
|  54 | cscript/wscript executing from user temp paths.                                             | `NewProcessName:("cscript.exe" OR "wscript.exe") AND CommandLine:("AppData\\Local\\Temp" )`                                                            |                                                    |
|  55 | mshta executing encoded content.                                                            | `NewProcessName: "mshta.exe" AND CommandLine:("-enc" OR "encoded")`                                                                                    |                                                    |
|  56 | Run key created with non-System32 path (persistence).                                       | `Message: ("CurrentVersion\\Run" AND NOT Message: "C:\\Windows\\System32")`                                                                            |                                                    |
|  57 | RunOnce entries for unexpected binaries.                                                    | `Message: ("RunOnce" AND NOT Message: "C:\\Windows\\System32")`                                                                                        |                                                    |
|  58 | Scheduled tasks referencing Temp directories.                                               | `EventID: 4698 AND Message: ("Temp" OR "AppData\\Local\\Temp")`                                                                                        |                                                    |
|  59 | WMI filter/consumer registries changed.                                                     | `Message: ("WBEM" OR "CIMOM" OR "EventFilter")`                                                                                                        |                                                    |
|  60 | Service image path pointing to user-writable directory.                                     | `EventID: 7045 AND Message: ("C:\\Users\\" OR "AppData")`                                                                                              |                                                    |
|  61 | Outbound connections to non-private IPs (search Message).                                   | `EventType: "Network" AND Message: NOT ("10." OR "192.168." OR "172.")`                                                                                |                                                    |
|  62 | Host repeatedly contacting same external IP (beaconing).                                    | `EventType: "Network" AND Message: /dest_ip:\\d+\.\d+\.\d+\.\d+/`                                                                                      |                                                    |
|  63 | High volume DNS requests to uncommon domains (Message contains query).                      | `EventType: "dns" AND Message: NOT ("local" OR "internal" OR "lan")`                                                                                   |                                                    |
|  64 | PowerShell making network connections.                                                      | `NewProcessName: "powershell.exe" AND EventType: "Network"`                                                                                            |                                                    |
|  65 | Large bytes sent flags in Message indicating exfiltration.                                  | `EventType: "Network" AND Message: /bytes_sent: [5-9][0-9]{5,}/`                                                                                       |                                                    |
|  66 | FTP/SMB traffic detected from endpoints (Message).                                          | `EventType: "Network" AND Message: ("FTP" OR "SMB" OR "port 21" OR "port 445")`                                                                        |                                                    |
|  67 | Unusual ICMP traffic patterns.                                                              | `EventType: "Network" AND Message: ("ICMP" OR "ping")`                                                                                                 |                                                    |
|  68 | HTTPS over uncommon ports from PowerShell.                                                  | `NewProcessName: "powershell.exe" AND EventType: "Network" AND Message: NOT ("port 443")`                                                              |                                                    |
|  69 | Host contacting many external IPs (possible scanning).                                      | `EventType: "Network"                                                                                                                                  | stats distinct_count(Message) by Hostname`         |
|  70 | DNS queries with long/random subdomains (entropy).                                          | `EventType: "dns" AND Message: /[a-z0-9]{8,}\./`                                                                                                       |                                                    |
|  71 | PsExec-style remote execution.                                                              | `NewProcessName: "psexec.exe" OR CommandLine: "\\\\*"`                                                                                                 |                                                    |
|  72 | RDP logon events from unusual sources.                                                      | `EventID: 4624 AND Message: ("LogonType: 10" AND NOT Message:("10." OR "192.168."))`                                                                   |                                                    |
|  73 | WinRM or WMI remote commands used for lateral movement.                                     | `NewProcessName: ("winrm.exe" OR "wmic.exe") AND CommandLine: ("-ComputerName" OR "/node:")`                                                           |                                                    |
|  74 | SMB enumeration and lateral scans (Message contains SMB).                                   | `EventType: "Network" AND Message: /SMB/`                                                                                                              |                                                    |
|  75 | Many remote logons by one account across hosts.                                             | `EventID: 4624                                                                                                                                         | stats distinct_count(Hostname) by SubjectUserName` |
|  76 | Port scanning behavior by single host (Message).                                            | `EventType: "Network"                                                                                                                                  | stats distinct_count(Message) by Hostname`         |
|  77 | Recon commands like netstat/arp executed.                                                   | `NewProcessName: ("netstat.exe" OR "arp.exe")`                                                                                                         |                                                    |
|  78 | Attempts to list remote shares (net view).                                                  | `NewProcessName: "net.exe" AND CommandLine: "view \\\\*"`                                                                                              |                                                    |
|  79 | ICMP sweeps to many targets (Message).                                                      | `EventType: "Network" AND Message: /ICMP/                                                                                                              | stats distinct_count(Message) by Hostname`         |
|  80 | Remote access outside business hours (EventTime hours).                                     | `EventID: 4624 AND (EventTime: "*" ) AND NOT (EventTime: "09:*" OR EventTime: "10:*" OR EventTime: "11:*" )`                                           |                                                    |
|  81 | Sudo-like or privilege escalation indicator on Linux (search CommandLine).                  | `CommandLine: ("sudo" OR "setuid" OR "pkexec")`                                                                                                        |                                                    |
|  82 | runas/cmstp execution for privilege escalation.                                             | `NewProcessName: ("runas.exe" OR "cmstp.exe")`                                                                                                         |                                                    |
|  83 | Setuid/setgid modifications detected in Message or file paths.                              | `Message: /suid                                                                                                                                        | sgid/ OR log.file.path: "/usr/*"`                  |
|  84 | UAC bypass binaries executed (event viewer, fodhelper).                                     | `NewProcessName: ("eventvwr.exe" OR "fodhelper.exe")`                                                                                                  |                                                    |
|  85 | Processes launched as SYSTEM from user sessions.                                            | `SubjectUserName: "SYSTEM" AND ParentProcessName: NOT "SYSTEM"`                                                                                        |                                                    |
|  86 | Executables dropped into Temp by non-admins.                                                | `log.file.path:("*\\Temp\\*" OR "*\\Downloads\\*") AND NewProcessName: *.exe`                                                                          |                                                    |
|  87 | Installer/archiver files created outside program dirs.                                      | `log.file.path:("*.exe" OR "*.msi" OR "*.zip" OR "*.rar") AND NOT log.file.path: ("C:\\Program Files\\*" OR "C:\\Windows\\*")`                         |                                                    |
|  88 | Scripts written to startup directory.                                                       | `log.file.path:("*\\Startup\\*") AND log.file.path:("*.ps1" OR "*.bat" OR "*.vbs")`                                                                    |                                                    |
|  89 | Shadow copies or backup files created in odd locations.                                     | `log.file.path:("*.vhd" OR "*.bak") AND NOT log.file.path:("C:\\Windows\\*" )`                                                                         |                                                    |
|  90 | svchost.exe running outside System32 location.                                              | `NewProcessName: "svchost.exe" AND CommandLine: NOT ("C:\\Windows\\System32\\*")`                                                                      |                                                    |
|  91 | Suspicious registry creations/modifications by reg.exe or PowerShell.                       | `NewProcessName: ("reg.exe" OR "powershell.exe") AND Message: ("Registry" OR "Set-ItemProperty" OR "New-ItemProperty")`                                |                                                    |
|  92 | Auto-run scripts added to roaming/appdata.                                                  | `log.file.path:("*\\AppData\\Roaming\\*" OR "*\\AppData\\Local\\*") AND log.file.path:("*.ps1" OR "*.vbs" )`                                           |                                                    |
|  93 | WMI filters/consumers presence in Message.                                                  | `Message: ("WMI" OR "WBEM" OR "CIMOM" OR "EventFilter")`                                                                                               |                                                    |
|  94 | Scheduled tasks modified to run non-System32 binaries.                                      | `EventID: 4698 AND CommandLine: NOT ("C:\\Windows\\System32\\*")`                                                                                      |                                                    |
|  95 | Startup folder changes by unusual processes.                                                | `log.file.path:("*\\Startup\\*") AND NewProcessName: NOT ("explorer.exe" OR "powershell.exe" OR "cmd.exe")`                                            |                                                    |
|  96 | PowerShell in Temp + external network connection — high-confidence compromise.              | `NewProcessName: "powershell.exe" AND CommandLine:("Temp" OR "AppData") AND EventType: "Network"`                                                      |                                                    |
|  97 | Credential dumping binary + service creation correlated.                                    | `(NewProcessName: "mimikatz.exe" OR CommandLine: "sekurlsa") AND EventID: 7045`                                                                        |                                                    |
|  98 | mshta executing remote URL and network events — fileless beacon.                            | `NewProcessName: "mshta.exe" AND CommandLine: ("http" OR "https") AND EventType: "Network"`                                                            |                                                    |
|  99 | Scheduled task creation + outbound connections outside office hours.                        | `EventID: 4698 AND EventType: "Network" AND EventTime: NOT ("09:*" OR "10:*" OR "11:*")`                                                               |                                                    |
| 100 | Encoded PowerShell that also writes to startup — persistence + execution.                   | `NewProcessName: "powershell.exe" AND CommandLine:("-enc" OR "-EncodedCommand") AND log.file.path:("*\\Startup\\*")`                                   |                                                    |

---

### Notes & Next Steps

* Some network fields like `dest_ip` are not present in your field list; where needed I used `Message` or `EventType` to detect network-related content — you can refine these once you confirm the exact network fields (e.g., `source.ip`, `destination.ip`) if available.
* If you prefer, I can convert this table into a CSV or Excel file and provide a download link so you can import it into your tracking system. I can also generate saved searches for Kibana (JSON) for bulk import.
* If you'd like, I will now **produce a CSV file** of this table and a set of **Kibana saved searches** ready to import. Let me know which one you want next.
